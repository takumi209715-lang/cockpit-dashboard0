<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Cockpit Dashboard — Market Monitor</title>
<meta name="viewport" content="width=1280, initial-scale=1">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Orbitron:wght@500;700;900&display=swap" rel="stylesheet">
<style>
:root {
    /* Colors */
    --bg-core: #020203;
    --c-cyan: #00f0ff;
    --c-cyan-dim: rgba(0, 240, 255, 0.15);
    --c-pink: #ff0055;
    --c-warn: #ffcc00;
    --c-text-main: #e0f0ff;
    --c-text-muted: #647b8c;
    
    /* Layout */
    --w: 1280px;
    --h: 800px;
}

* { box-sizing: border-box; }

body {
    margin: 0; 
    height: 100vh;
    background: #000;
    color: var(--c-text-main);
    font-family: 'JetBrains Mono', monospace;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
}

/* --- SCALING WRAPPER --- */
/* 1280x800を基準に、画面に合わせて縮小するラッパー */
#scaler {
    width: var(--w);
    height: var(--h);
    position: relative;
    transform-origin: center center;
}

/* --- MAIN FRAME (COCKPIT) --- */
.cockpit {
    width: 100%; height: 100%;
    background: radial-gradient(circle at 50% 50%, #0d1219 0%, #000000 120%);
    position: relative;
    border: 2px solid #333;
    overflow: hidden;
    display: grid;
    grid-template-rows: 90px 1fr 160px; /* Header / Main / Footer */
    padding: 20px;
    gap: 15px;
}

/* 背景エフェクト: スキャンラインとグリッド */
.cockpit::before {
    content: ''; position: absolute; inset: 0; pointer-events: none; z-index: 0;
    background: 
        linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%),
        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
    background-size: 100% 4px, 6px 100%;
}
.cockpit::after {
    content: ''; position: absolute; inset: 0; pointer-events: none; z-index: 0;
    background: radial-gradient(circle, transparent 60%, rgba(0,0,0,0.8) 100%);
}

/* --- COMMON HUD ELEMENTS --- */
.hud-panel {
    background: rgba(10, 20, 30, 0.6);
    border: 1px solid var(--c-cyan-dim);
    backdrop-filter: blur(4px);
    position: relative;
    z-index: 1;
}
/* 装飾的な角（Clip-pathでSFチックに） */
.corner-cut {
    clip-path: polygon(
        15px 0, 100% 0, 
        100% calc(100% - 15px), calc(100% - 15px) 100%, 
        0 100%, 0 15px
    );
}

/* --- HEADER BAR (Clock & Weather Integrated) --- */
.top-bar {
    display: grid;
    grid-template-columns: 320px 1fr 320px;
    align-items: center;
    border-bottom: 1px solid var(--c-cyan-dim);
    padding: 0 20px;
    background: rgba(0, 240, 255, 0.03);
}

/* Left: Time */
.sys-time {
    display: flex; flex-direction: column;
}
.clock-main {
    font-family: 'Orbitron'; font-size: 48px; line-height: 1;
    color: #fff; text-shadow: 0 0 10px rgba(255,255,255,0.5);
    display: flex; align-items: baseline; gap: 8px;
}
.clock-sec { font-size: 24px; color: var(--c-cyan); }
.clock-date { color: var(--c-cyan); font-size: 14px; letter-spacing: 0.2em; margin-top: 4px; }

/* Center: Title/Decor */
.sys-title {
    text-align: center;
    font-family: 'Orbitron'; font-weight: 900; letter-spacing: 0.3em;
    font-size: 20px; color: var(--c-cyan-dim);
    border-left: 1px solid var(--c-cyan-dim);
    border-right: 1px solid var(--c-cyan-dim);
    height: 60%;
    display: flex; align-items: center; justify-content: center;
}

/* Right: Weather */
.sys-env {
    display: flex; align-items: center; justify-content: flex-end; gap: 20px;
}
.env-data { text-align: right; }
.env-temp { font-family: 'Orbitron'; font-size: 36px; font-weight: bold; line-height: 1; }
.env-loc { color: var(--c-text-muted); font-size: 12px; letter-spacing: 0.1em; }
.env-icon svg { width: 48px; height: 48px; fill: none; stroke: var(--c-cyan); filter: drop-shadow(0 0 5px var(--c-cyan)); }

/* --- MAIN GRID (Charts) --- */
.main-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    height: 100%;
}

.monitor-card {
    display: flex; flex-direction: column;
    padding: 15px;
    border-top: 2px solid var(--c-cyan); /* アクセント */
}

.m-header {
    display: flex; justify-content: space-between; align-items: baseline;
    margin-bottom: 15px;
    border-bottom: 1px dashed var(--c-cyan-dim);
    padding-bottom: 8px;
}
.m-title { font-size: 18px; font-weight: bold; color: #fff; }
.m-code { font-family: 'Orbitron'; color: var(--c-cyan); font-size: 12px; }

.m-val-row { display: flex; align-items: flex-end; gap: 15px; margin-bottom: 10px;}
.m-price { font-family: 'Orbitron'; font-size: 42px; font-weight: 700; line-height: 1; }
.m-diff { font-family: 'JetBrains Mono'; font-weight: bold; font-size: 16px; }

/* Chart Area */
.chart-box {
    flex: 1; width: 100%; 
    position: relative;
    background: rgba(0,0,0,0.3);
    border: 1px solid rgba(255,255,255,0.05);
}
.chart-svg { width: 100%; height: 100%; display: block; }
.chart-line { fill: none; stroke-width: 3; stroke-linecap: round; filter: drop-shadow(0 0 4px currentColor); }
.chart-fill { stroke: none; opacity: 0.2; }

/* Color States */
.up { color: var(--c-cyan); }
.up .chart-line { stroke: var(--c-cyan); }
.up .chart-fill { fill: var(--c-cyan); }

.down { color: var(--c-pink); }
.down .chart-line { stroke: var(--c-pink); }
.down .chart-fill { fill: var(--c-pink); }

/* --- FOOTER (News Log) --- */
.footer-log {
    display: flex; flex-direction: column;
    padding: 10px 20px;
}
.log-header {
    font-family: 'Orbitron'; font-size: 12px; color: var(--c-cyan);
    margin-bottom: 10px; display: flex; align-items: center; gap: 10px;
}
.log-header::after { content:''; height:1px; background: var(--c-cyan-dim); flex:1; }

.news-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-auto-flow: dense;
    gap: 5px 40px;
    list-style: none; padding: 0; margin: 0;
    overflow-y: hidden;
}
.news-item {
    font-size: 13px; color: var(--c-text-muted);
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    border-left: 2px solid transparent;
    padding-left: 8px;
    transition: all 0.3s;
}
.news-item:hover {
    color: var(--c-text-main);
    border-left-color: var(--c-cyan);
    background: linear-gradient(90deg, rgba(0,240,255,0.1), transparent);
}
.news-time { color: var(--c-cyan); font-size: 11px; margin-right: 10px; font-family: 'Orbitron'; }
.news-link { text-decoration: none; color: inherit; }

/* --- RESPONSIVE SCALING --- */
@media (max-width: 1300px), (max-height: 820px) {
    #scaler {
        transform: scale(min(calc(100vw / 1280), calc(100vh / 800)));
    }
}
</style>
</head>
<body>

<div id="scaler">
    <div class="cockpit corner-cut">
        
        <header class="top-bar hud-panel">
            <div class="sys-time">
                <div class="clock-main">
                    <span id="time-hm">--:--</span>
                    <span id="time-s" class="clock-sec">--</span>
                </div>
                <div id="date" class="clock-date">----.---.--</div>
            </div>
            
            <div class="sys-title">
                MARKET MONITOR // SYSTEM_READY
            </div>
            
            <div class="sys-env">
                <div class="env-data">
                    <div id="w-temp" class="env-temp">--°</div>
                    <div id="w-desc" class="env-loc">MATSUSAKA // SCANNING</div>
                </div>
                <div id="w-icon" class="env-icon"></div>
            </div>
        </header>

        <section class="main-grid">
            <div class="monitor-card hud-panel corner-cut" id="stock-0">
                <div class="m-header">
                    <span class="m-title">NIKKEI 225</span>
                    <span class="m-code">INDEX</span>
                </div>
                <div class="m-val-row">
                    <span class="m-price">--</span>
                    <span class="m-diff">--</span>
                </div>
                <div class="chart-box" id="chart-0"></div>
            </div>
            <div class="monitor-card hud-panel corner-cut" id="stock-1">
                <div class="m-header">
                    <span class="m-title">RAKUTEN G.</span>
                    <span class="m-code">4755.T</span>
                </div>
                <div class="m-val-row">
                    <span class="m-price">--</span>
                    <span class="m-diff">--</span>
                </div>
                <div class="chart-box" id="chart-1"></div>
            </div>
            <div class="monitor-card hud-panel corner-cut" id="stock-2">
                <div class="m-header">
                    <span class="m-title">GENDA INC.</span>
                    <span class="m-code">9166.T</span>
                </div>
                <div class="m-val-row">
                    <span class="m-price">--</span>
                    <span class="m-diff">--</span>
                </div>
                <div class="chart-box" id="chart-2"></div>
            </div>
        </section>

        <footer class="footer-log hud-panel corner-cut">
            <div class="log-header">INCOMING TRANSMISSION // RSS_FEED</div>
            <ul class="news-grid" id="news-list">
                <li>INITIALIZING DATA STREAM...</li>
            </ul>
        </footer>

    </div>
</div>

<script>
/* LOGIC: Same as before but adapted to new DOM IDs 
*/

// --- CLOCK ---
(function(){
    const dEl = document.getElementById('date');
    const hmEl = document.getElementById('time-hm');
    const sEl = document.getElementById('time-s');
    function tick(){
        const now = new Date();
        const y = now.getFullYear();
        const m = String(now.getMonth()+1).padStart(2,'0');
        const d = String(now.getDate()).padStart(2,'0');
        const day = ['SUN','MON','TUE','WED','THU','FRI','SAT'][now.getDay()];
        dEl.textContent = `${y}.${m}.${d} :: ${day}`;
        hmEl.textContent = now.toLocaleTimeString('en-US',{hour12:false, hour:'2-digit', minute:'2-digit'});
        sEl.textContent = String(now.getSeconds()).padStart(2,'0');
        setTimeout(tick, 1000);
    }
    tick();
})();

// --- WEATHER ---
(function(){
    const URL = 'https://api.open-meteo.com/v1/forecast?latitude=34.576&longitude=136.529&current=temperature_2m,weather_code&timezone=Asia%2FTokyo';
    async function load(){
        try {
            const r = await fetch(URL);
            const d = await r.json();
            const t = Math.round(d.current.temperature_2m);
            const c = d.current.weather_code;
            
            document.getElementById('w-temp').textContent = `${t}°C`;
            let txt = 'CLEAR';
            if(c>0) txt='CLOUDY'; if(c>50) txt='RAIN'; if(c>70) txt='SNOW'; if(c>95) txt='STORM';
            document.getElementById('w-desc').textContent = `MATSUSAKA // ${txt}`;

            const iconWrap = document.getElementById('w-icon');
            let path = '';
            // Simplified vector icons
            if(c===0) path='<circle cx="24" cy="24" r="10" stroke-width="3"/><path d="M24 4v4M24 40v4M10 10l3 3M35 35l3 3M4 24h4M40 24h4M10 38l3-3M35 13l3-3" stroke-width="3"/>'; 
            else if(c<50) path='<path d="M14 36h20a10 10 0 000-20 12 12 0 00-22 4 8 8 0 002 16z" stroke-width="3"/>'; 
            else path='<path d="M14 32h20a10 10 0 000-20 12 12 0 00-22 4 8 8 0 002 16z" stroke-width="3"/><path d="M18 40l-4 6M30 38l-4 6" stroke-width="3"/>';
            
            iconWrap.innerHTML = `<svg viewBox="0 0 48 48">${path}</svg>`;
        } catch(e){ console.log(e); }
    }
    load(); setInterval(load, 600000);
})();

// --- STOCKS ---
(function(){
    const STOCKS = [
        { id:'stock-0', sym:'^N225' },
        { id:'stock-1', sym:'4755.T' },
        { id:'stock-2', sym:'9166.T' }
    ];
    const via = u => `https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`;

    function createChartSvg(prices, isUp) {
        if(!prices || prices.length < 2) return '';
        const w = 400, h = 150; 
        const min = Math.min(...prices);
        const max = Math.max(...prices);
        const range = max - min || 1;
        const points = prices.map((p, i) => {
            const x = (i / (prices.length - 1)) * w;
            const y = h - ((p - min) / range) * (h - 10) - 5; 
            return `${x},${y}`;
        });
        const lineD = `M ${points.join(' L ')}`;
        const fillD = `${lineD} L ${w},${h} L 0,${h} Z`;
        return `<svg class="chart-svg" viewBox="0 0 ${w} ${h}" preserveAspectRatio="none"><path class="chart-fill" d="${fillD}" /><path class="chart-line" d="${lineD}" /></svg>`;
    }

    async function updateStock(s){
        // Yahoo Finance Chart API
        const url = `https://query1.finance.yahoo.com/v8/finance/chart/${s.sym}?interval=15m&range=1d`;
        try {
            const res = await fetch(via(url));
            const json = await res.json();
            const result = json.chart.result[0];
            const meta = result.meta;
            const quotes = result.indicators.quote[0].close;
            const validPrices = quotes.filter(p => p != null);
            
            const price = meta.regularMarketPrice;
            const prev = meta.chartPreviousClose;
            const diff = price - prev;
            const pct = (diff / prev) * 100;
            const isUp = diff >= 0;

            const el = document.getElementById(s.id);
            el.classList.remove('up','down');
            el.classList.add(isUp ? 'up' : 'down');

            el.querySelector('.m-price').textContent = price.toLocaleString(undefined, {maximumFractionDigits:0});
            el.querySelector('.m-diff').textContent = `${isUp?'+':''}${diff.toFixed(0)} (${pct.toFixed(2)}%)`;
            
            const svg = createChartSvg(validPrices, isUp);
            document.getElementById(s.id.replace('stock','chart')).innerHTML = svg;
        } catch(e) { console.error(e); }
    }
    function loadAll(){ STOCKS.forEach(updateStock); }
    loadAll(); setInterval(loadAll, 120000);
})();

// --- NEWS ---
(function(){
    const FEED = 'https://news.yahoo.co.jp/rss/topics/it.xml';
    const via = u => `https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`;
    async function load(){
        try {
            const r = await fetch(via(FEED));
            const txt = await r.text();
            const doc = new DOMParser().parseFromString(txt,'text/xml');
            const items = [...doc.querySelectorAll('item')].slice(0, 8); // Show 8 items
            const ul = document.getElementById('news-list');
            ul.innerHTML = '';
            items.forEach(item => {
                const title = item.querySelector('title').textContent;
                const link = item.querySelector('link').textContent;
                const pub = new Date(item.querySelector('pubDate').textContent);
                const timeStr = pub.getHours().toString().padStart(2,'0') + ':' + pub.getMinutes().toString().padStart(2,'0');
                
                const li = document.createElement('li');
                li.className = 'news-item';
                li.innerHTML = `<span class="news-time">[${timeStr}]</span><a class="news-link" href="${link}" target="_blank">${title}</a>`;
                ul.appendChild(li);
            });
        } catch(e){}
    }
    load(); setInterval(load, 600000);
})();
</script>
</body>
</html>